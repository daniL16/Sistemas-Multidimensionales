%%%
% Plantilla de Trabajo
% Modificación de una plantilla de Latex de Frits Wenneker para adaptarla 
% al castellano y a las necesidades de escribir informática y matemáticas.
%
% Editada por: Mario Román
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Short Sectioned Assignment
% LaTeX Template
% Version 1.0 (5/5/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Frits Wenneker (http://www.howtotex.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PAQUETES Y CONFIGURACIÓN DEL DOCUMENTO
%----------------------------------------------------------------------------------------

%%% Configuración del papel.
% fourier: Usa la fuente Adobe Utopia. (Comentando la línea usa la fuente normal)
\documentclass[paper=a4, fontsize=11pt, spanish]{scrartcl} 
\usepackage{fourier}

% Centra y formatea los títulos de sección.
% Quita la indentación de párrafos.
\usepackage{sectsty} % Allows customizing section commands
\allsectionsfont{\centering \normalfont\scshape} % Make all sections centered, the default font and small caps
\setlength\parindent{0pt} % Removes all indentation from paragraphs - comment this line for an assignment with lots of text

% Permite elegir cabeceras y pies de página.
\usepackage{fancyhdr} % Custom headers and footers
\pagestyle{fancyplain} % Makes all pages in the document conform to the custom headers and footers
\fancyhead{} % No page header - if you want one, create it in the same way as the footers below
\fancyfoot[L]{} % Empty left footer
\fancyfoot[C]{} % Empty center footer
\fancyfoot[R]{\thepage} % Page numbering for right footer
\renewcommand{\headrulewidth}{0pt} % Remove header underlines
\renewcommand{\footrulewidth}{0pt} % Remove footer underlines
\setlength{\headheight}{13.6pt} % Customize the height of the header


%%% Castellano.
% noquoting: Permite uso de comillas no españolas.
% lcroman: Permite la enumeración con numerales romanos en minúscula.
% fontenc: Usa la fuente completa para que pueda copiarse correctamente del pdf.
\usepackage[spanish,es-noquoting,es-lcroman]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\selectlanguage{spanish}


%%% Matemáticas.
% Paquetes de la AMS. Para entornos de ecuaciones.
\usepackage{amsmath,amsfonts,amsthm}

% Incluye números entre secciones y ecuaciones.
\numberwithin{equation}{section} % Number equations within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{figure}{section} % Number figures within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{table}{section} % Number tables within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)

%%% Códigos C / C++ / SQL ...
% Paquete listings para visualización de código más elegante
\usepackage{xcolor,listings}
\usepackage{textcomp}
\lstset{upquote=true}

%% Gráficos e imagenes:
\usepackage{graphicx}


%----------------------------------------------------------------------------------------
%	TÍTULO
%----------------------------------------------------------------------------------------
% Título con las líneas horizontales, nombres y fecha.

\newcommand{\horrule}[1]{\rule{\linewidth}{#1}} % Create horizontal rule command with 1 argument of height

\title{
  \normalfont \normalsize 
  \textsc{Universidad de Granada.\\Sistemas Multidimensionales} \\ [25pt] % Your university, school and/or department name(s)
  \horrule{0.5pt} \\[0.4cm] % Thin top horizontal rule
  \huge Práctica 2: Implementación de esquemas de bases de datos multidimensionales I \\ % The assignment title
  \horrule{2pt} \\[0.5cm] % Thick bottom horizontal rule
}

\author{Daniel López García\\Rafael Nogales Vaquero} % Your name

\date{\normalsize\today} % Today's date or a custom date



%----------------------------------------------------------------------------------------
%	DOCUMENTO
%----------------------------------------------------------------------------------------


\begin{document}
\maketitle % Escribe el título
Cómo queremos implementar un sistema multidimensional ROLAP en Estrella, cada dimensión debe tener una tabla. Por ello, hemos de crear la tabla Fecha para conseguirlo hacemos una consulta en la tabla LineaDeVenta de las fechas existentes, obteniendo además de la fecha, el año. 
\newline El código SQL generado para la consulta es el siguiente:
\begin{lstlisting}[
language=SQL,
breaklines=true,
showspaces=false,
basicstyle=\ttfamily,
numbers=left,
numberstyle=\tiny,
commentstyle=\color{gray}
]
SELECT DISTINCT LineaDeVenta.Fecha,Year([LineaDeVenta].[Fecha]) AS Anio INTO Fecha 
FROM LineaDeVenta;
\end{lstlisting}

Podemos ver el resultado de la ejecución de la consulta en las siguientes imágenes:\\
\\
\begin{center}
	\includegraphics[scale=0.35]{fecha1.png}
	\includegraphics[scale=0.35]{fecha2.png}
\end{center}
\bigskip
A continuación,  llevaremos a cabo las agregaciones necesarias en la tabla LineaDeVenta para obtener las mediciones unidades y cliente. Además, añadiremos las mediciones calculadas importe y media precio. Esta consulta será guardada en una tabla auxiliar. 
\newline El código SQL necesario es el siguiente:
\begin{lstlisting}[
language=SQL,
breaklines=true,
showspaces=false,
basicstyle=\ttfamily,
numbers=left,
numberstyle=\tiny,
commentstyle=\color{gray}
]
SELECT LineaDeVenta.Tienda, LineaDeVenta.[ISBN-10], LineaDeVenta.Fecha, Sum(LineaDeVenta.Unidades) AS Unidades_, Count(LineaDeVenta.Ticket) AS Clientes, Sum([PVP]*[Unidades]) AS Importe, [Importe]/Sum([Unidades]) AS Media_precio INTO aux
FROM Libro LEFT JOIN LineaDeVenta ON Libro.[ISBN-10] = LineaDeVenta.[ISBN-10]
GROUP BY LineaDeVenta.Tienda, LineaDeVenta.[ISBN-10], LineaDeVenta.Fecha;
\end{lstlisting}

En las siguientes imágenes podemos ver, la vista de diseño de la consulta y el resultado obtenido, respectivamente.\\
\\
\begin{center}
	\includegraphics[scale=0.35]{sum1.png}
	\includegraphics[scale=0.35]{sum2.png}
\end{center}
\bigskip
Finalmente, cambiaremos los valores codigo de tienda, ISBN-10 y Fecha por los códigos autonúmericos generados en las tablas de las dimensiones.
\newline El código SQL necesario es el siguiente:

\begin{lstlisting}[
language=SQL,
breaklines=true,
showspaces=false,
basicstyle=\ttfamily,
numbers=left,
numberstyle=\tiny,
commentstyle=\color{gray}
]
SELECT Libro.Id_libro, Fecha.Id_fecha, Tienda.Id_tienda, aux.Unidades_, aux.Clientes, aux.Importe, aux.Media_precio INTO Venta
FROM Fecha INNER JOIN (Tienda INNER JOIN (aux INNER JOIN Libro ON aux.[ISBN-10] = Libro.[ISBN-10]) ON Tienda.Cod_tienda = aux.Tienda) ON Fecha.Fecha = aux.Fecha
WHERE (((aux.[ISBN-10])=[Libro].[ISBN-10]) AND ((aux.Fecha)=[Fecha].[Fecha]) AND ((aux.Tienda)=[Tienda].[Cod_tienda]));


\end{lstlisting}
En las siguientes imágenes se muestra la consulta que hemos realizado y el resultado definitivo de la tabla del hecho Venta.
\begin{center}
	\includegraphics[scale=0.35]{id1.png}
	\includegraphics[scale=0.35]{id2.png}
\end{center}

Ahora, cuando ya tenemos la base de datos correctamente configurada la copiamos en la carpeta donde tenemos StarTracker junto con el siguiente archivo STARTRAK.ini

\begin{lstlisting}[
breaklines=true,
showspaces=false,
basicstyle=\ttfamily,
numbers=left,
numberstyle=\tiny,
commentstyle=\color{gray}
]
Date: 10-10-2006
Time: 10:37:15
CDROM Drive Letter: c
Query Path:
Default Font: Times New Roman
European Paper: No
Private Group User Name: Public

Database Type: ACCESS
Database Path: 
Database Name: PRACTIC2.MDB
Allow Drill Across: Yes
Auto Pretty Print Field Names: Yes

Family: Ventas en una cadena de librerias
Fact Table Name: Venta
Fact Table Caption: Venta
Fact Table Additive Field: Importe, format = $#,##0.00
Fact Table Additive Field: Unidades_, format = #,##0
Fact Table Additive Field: Clientes, format = #,##0
Calculation: {Media_precio} = {importe}/{unidades_}, format = $#,##0.00

Dimension Table Name: Fecha, Dimension Key: Id_fecha, Fact Key: Id_fecha, Group Table: Fecha_GP
Dimension Table Name: Libro, Dimension Key: Id_libro, Fact Key: Id_libro, Group Table: Libro_GP
Dimension Table Name: Tienda, Dimension Key: Id_tienda, Fact Key: Id_tienda, Group Table: Tienda_GP
Date Field: Fecha, table name = Fecha, type = Date, format = dd/mm/yyyy
Time Dimension Table Name: Fecha

\end{lstlisting}

Ahora abrimos StarTracker y lo utilizamos para generar un informe en el que consultaremos cuales son los libros que generan mayor beneficio a nuestra linea de tiendas para poder centrar los esfuerzos publicitarios en estos y descatalogar los que sean menos productivos:
\\

\includegraphics[scale=0.43]{informe1.png}

El nivel del cubo es: Que: Titulo, Cuando: TODO, Donde: TODO

\end{document}